<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Placement Test</title>
    <!--Uche, added css for styling-->
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
            background-color: #87CEEB;
            /* Creates a light blue background */
            color: white;
            /* White text for a contrast */
        }

        #myChart {
            max-width: 600px;
            max-height: 400px;
            margin-top: 20px;
        }

        table {
            margin-top: 20px;
            border-collapse: collapse;
            width: 50%;
            background-color: #1E90FF;
            /* Dark blue for the table background */
            color: white;
        }

        table,
        th,
        td {
            border: 1px solid white;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
        }
    </style>
</head>

<body onload="getBudgetInfo()">
    <div>
        <canvas id="myChart"></canvas>
    </div>
    <div>
        <table id="infoTableBudget">
            <!--Uche, added '<th>' and '<td>' tags for table structure and formatting-->
            <tr>
                <th>Category</th>
                <th>Info</th>
            </tr>

            <tr id="incomeRow">
                <td>Income</td>

            </tr>
            <tr id="expensesRow">
                <td>Expenses</td>

            </tr>
            <tr id="savingsRow">
                <td>Savings</td>

            </tr>


        </table>
    </div>
    <div>
        <a>
            <button onclick="openProjectPage()"> Return</button>
        </a>
    </div>

    <!-- Uche, ajusted the 'background colour' values to use the suitable RGB notation-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('myChart').getContext('2d');
        function retrieveUserInfo() {


        }

        function getBudgetInfo() {
            var user_ref = database.ref('users/' + localStorage.getItem('key') + '/' + 'budgets/' + localStorage.getItem('budgetName'))
            user_ref.on('value', function (snapshot) {
                var data = snapshot.val()
                const incomeSource = data.IncomeSource
                const incomeAmount = parseInt(data.IncomeAmount)
                const incomeFrequency = data.IncomeFrequency
                const incomeDate = data.IncomeDate
                const expenseCategory = data.ExpenseCategory
                const expenseAmount = parseInt(data.ExpenseAmount)
                const expenseFrequency = data.ExpenseFrequency
                const expenseDate = data.ExpenseDate
                const savingsAmount=incomeAmount-expenseAmount

                const myChart = new Chart(ctx,
                    {
                        type: 'doughnut',
                        data: {
                            labels: ['Income', 'Expenses', 'Savings'],
                            datasets: [{
                                label: 'My First Dataset',
                               // backgroundColor: ['rgb(0,120,300)', 'rgb(200,50,0,100)', 'rgb(0,220,0,100)'],
                                backgroundColor: ['rgb(0,220,0,100)', 'rgb(200,50,0,100)','rgb(0,120,300)' ],
                                borderColor: 'rgb(1,1,1)',
                                data: [incomeAmount, expenseAmount, savingsAmount],
                            }
                            ]
                        },


                    });

           console.log("incomeRowAppending,,")
            const incomeRowToBeAppended = document.getElementById('incomeRow');
            let tdIncome = document.createElement("td");
            tdIncome.id = "incomeRowInfo";
            //let tdName = tdPart.id;
            incomeRowToBeAppended.appendChild(tdIncome);


            tdIncome.innerHTML = incomeAmount;


            console.log("expensesRow Appending..")
            const expensesRowToBeAppended = document.getElementById('expensesRow');
            let tdExpenses = document.createElement("td");
            tdExpenses.id = "expensesInfo";
            //let tdName = tdPart.id;
            expensesRowToBeAppended.appendChild(tdExpenses);


            tdExpenses.innerHTML = expenseAmount;


            console.log("SavingsRow Appending..")
            const savngsRowToBeAppended = document.getElementById('savingsRow');
            let tdSavings = document.createElement("td");
            tdSavings.id = "byTimeRowInfo";
            //let tdName = tdPart.id;
            savngsRowToBeAppended.appendChild(tdSavings);


            tdSavings.innerHTML = savingsAmount;



            })


        }
    </script>
</body>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
               https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

<!-- Our script must be loaded after firebase references -->
<script src="firebase.js"></script>

</html>